<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­æ³•é«˜äº®æµ‹è¯• - æ”¯ä»˜å­¦ä¹ ç½‘</title>
    <link rel="stylesheet" href="css/style.css?v=1.1">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="index.html">ğŸ’³ æ”¯ä»˜å­¦ä¹ ç½‘</a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="gateways.html">æ”¯ä»˜ç½‘å…³</a></li>
                <li><a href="simulator.html">æ”¯ä»˜æ¨¡æ‹Ÿ</a></li>
                <li><a href="security.html">å®‰å…¨æœºåˆ¶</a></li>
                <li><a href="international-payment.html">è·¨å¢ƒæ”¯ä»˜</a></li>
                <li><a href="crypto-payment.html">åŠ å¯†æ”¯ä»˜</a></li>
                <li><a href="cross-border-eCommerce.html">è·¨å¢ƒç”µå•†</a></li>
            </ul>
            <div class="hamburger"><span></span><span></span><span></span></div>
        </div>
    </nav>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header">
        <div class="container">
            <h1>ğŸ” è¯­æ³•é«˜äº®æµ‹è¯•</h1>
            <p>æµ‹è¯•ä»£ç å—çš„è¯­æ³•é«˜äº®æ•ˆæœ</p>
        </div>
    </div>

    <main>
        <div class="container">
            <!-- ä»£ç å—æµ‹è¯• -->
            <div class="content">
                <h2>ğŸ’» ä»£ç å—è¯­æ³•é«˜äº®æµ‹è¯•</h2>
                
                <div class="code-block">
<span class="comment"># ç­¾åç®—æ³•å®ç°è¯¦è§£</span>
<span class="keyword">import</span> hmac
<span class="keyword">import</span> hashlib

<span class="comment"># æ­¥éª¤1: å‚æ•°é¢„å¤„ç†</span>
<span class="keyword">def</span> <span class="function">prepare_params</span>(raw_params):
    <span class="comment"># ç§»é™¤ç­¾åå­—æ®µå¹¶æŒ‰å­—å…¸åºæ’åº</span>
    clean_params = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> raw_params.items() <span class="keyword">if</span> k != <span class="string">'sign'</span>}
    <span class="keyword">return</span> <span class="function">sorted</span>(clean_params.items())

<span class="comment"># æ­¥éª¤2: ç”Ÿæˆç­¾å</span>
<span class="keyword">def</span> <span class="function">generate_signature</span>(params, secret_key):
    <span class="comment"># æŒ‰å‚æ•°åæ’åº</span>
    sorted_params = <span class="function">prepare_params</span>(params)
    
    <span class="comment"># æ‹¼æ¥å‚æ•°å­—ç¬¦ä¸²</span>
    param_str = <span class="string">"&"</span>.join([f<span class="string">"{k}={v}"</span> <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted_params])
    
    <span class="comment"># æ·»åŠ å¯†é’¥å¹¶ç”Ÿæˆç­¾å</span>
    sign_str = f<span class="string">"{param_str}&key={secret_key}"</span>
    
    <span class="comment"># ä½¿ç”¨HMAC-SHA256ç”Ÿæˆç­¾å</span>
    sign = hmac.<span class="function">new</span>(
        secret_key.encode(<span class="string">'utf-8'</span>),
        sign_str.encode(<span class="string">'utf-8'</span>),
        hashlib.sha256
    ).hexdigest().lower()  <span class="comment"># è½¬æ¢ä¸ºå°å†™</span>
    
    <span class="keyword">return</span> sign

<span class="comment"># æ­¥éª¤3: éªŒè¯ç­¾å</span>
<span class="keyword">def</span> <span class="function">verify_signature</span>(received_params, received_sign, secret_key):
    <span class="comment"># é‡æ–°è®¡ç®—ç­¾å</span>
    expected_sign = <span class="function">generate_signature</span>(received_params, secret_key)
    
    <span class="comment"># å®‰å…¨æ¯”è¾ƒï¼ˆé˜²æ­¢æ—¶åºæ”»å‡»ï¼‰</span>
    <span class="keyword">return</span> hmac.compare_digest(expected_sign, received_sign.lower())

<span class="comment"># ä½¿ç”¨ç¤ºä¾‹</span>
sample_params = {
    <span class="string">"amount"</span>: <span class="string">"100.00"</span>,
    <span class="string">"currency"</span>: <span class="string">"CNY"</span>,
    <span class="string">"merchant_id"</span>: <span class="string">"M123456"</span>,
    <span class="string">"order_id"</span>: <span class="string">"ORD20230101001"</span>,
    <span class="string">"timestamp"</span>: <span class="string">"1672531200"</span>
}
api_secret = <span class="string">"your_super_secret_api_key_here"</span>

calculated_signature = <span class="function">generate_signature</span>(sample_params, api_secret)
<span class="function">print</span>(f<span class="string">"è®¡ç®—å¾—åˆ°çš„ç­¾å: {calculated_signature}"</span>)

<span class="comment"># éªŒè¯ç­¾å</span>
is_valid = <span class="function">verify_signature</span>(sample_params, calculated_signature, api_secret)
<span class="function">print</span>(f<span class="string">"ç­¾åæ˜¯å¦æœ‰æ•ˆ: {is_valid}"</span>)
                </div>
                
                <h3>å…¶ä»–è¯­æ³•æµ‹è¯•</h3>
                
                <div class="code-block">
<span class="comment">// JavaScript ç¤ºä¾‹</span>
<span class="keyword">const</span> payment = {
    <span class="function">createOrder</span>: <span class="keyword">async</span> (params) => {
        <span class="keyword">try</span> {
            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'/api/payment/create'</span>, {
                <span class="function">method</span>: <span class="string">'POST'</span>,
                <span class="function">headers</span>: {
                    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,
                },
                <span class="function">body</span>: <span class="function">JSON.stringify</span>(params)
            });
            
            <span class="keyword">return</span> <span class="keyword">await</span> response.<span class="function">json</span>();
        } <span class="keyword">catch</span> (error) {
            <span class="function">console.error</span>(<span class="string">'Payment error:'</span>, error);
            <span class="keyword">throw</span> error;
        }
    }
};
                </div>
            </div>
        </div>
    </main>

    <footer><div class="container"></div></footer>
    <script src="js/main.js"></script>
</body>
</html>